# paths
# - target
spath = src
opath = $(bpath)/obj
mpath = man
# - sources
ccsrc = $(wildcard $(spath)/*.c)
ccsrcc = $(wildcard $(spath)/*.cc)
ccsrcpp = $(wildcard $(spath)/*.cpp)

# binarys
objc = $(ccsrc:.c=.o)
objcc = $(ccsrcc:.cc=.o)
objcpp = $(ccsrcpp:.cpp=.o)

bin = $(bpath)/$(pkgname)
man = $(mpath)/$(pkgname).1

INSTALL = install
RM = rm
CC = gcc
CXX = g++
CCFLAGS = -std=c89 -Wall -Wno-strict-aliasing $(opt) $(dbg) -I$(spath)
CXXFLAGS = -ansi -pedantic -Wall -Wno-strict-aliasing $(opt) $(dbg) -D'PM_VERSION="$(shell cat VERSION)"' -I$(spath)
LDFLAGS = 

$(bin): $(objc) $(objcc) $(objcpp)
	$(CXX) $(LDFLAGS) $(CXXFLAGS) $(objc) $(objcc) $(objcpp) -o $@

%.o: %.c
	$(CC) -c $(CCFLAGS) -o $@ $<

%.o: %.cc
	$(CXX) -c $(CXXFLAGS) -o $@ $<

%.o: %.cpp
	$(CXX) -c $(CXXFLAGS) -o $@ $<

.PHONY: all
all: $(bin)

.PHONY: install
install: all
	$(INSTALL) -D -m 775 $(bin) $(PREFIX)/bin/$(pkgname)
	$(INSTALL) -D -c -m 444 $(man) $(PREFIX)/share/man/man1/$(pkgname).1
				  
.PHONY: uninstall
uninstall:
	$(RM) -f $(PREFIX)/bin/$(pkgname)
	$(RM) -f $(PREFIX)/share/man/man1/$(pkgname).1

.PHONY: clean
clean:
	rm -rf $(objc) $(objcc) $(objcpp)

.PHONY: clean-all
clean-all: clean
	rm -f Makefile $(bin)
